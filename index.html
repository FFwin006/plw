<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>多域名页面检测工具</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }
        .header {
            background-color: #f5f5f5;
            padding: 10px;
            border-bottom: 1px solid #ddd;
            text-align: center;
        }
        .input-area {
            padding: 15px;
            background-color: #f9f9f9;
            border-bottom: 1px solid #ddd;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .button-area {
            padding: 10px;
            background-color: #f5f5f5;
            display: flex;
            gap: 10px;
            border-bottom: 1px solid #ddd;
            align-items: center;
        }
        .viewer-area {
            flex: 1;
            position: relative;
        }
        .browser-view {
            width: 100%;
            height: 100%;
            border: none;
        }
        .progress-container {
            flex: 1;
            margin-left: 10px;
        }
        .progress-bar {
            height: 20px;
            background-color: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }
        .progress {
            height: 100%;
            background-color: #4CAF50;
            width: 0%;
            transition: width 0.3s;
        }
        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #333;
            font-size: 12px;
            font-weight: bold;
        }
        .status-bar {
            display: flex;
            justify-content: space-between;
            padding: 5px 10px;
            background-color: #333;
            color: white;
            font-size: 14px;
        }
        button {
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        #checkButton {
            background-color: #4CAF50;
        }
        #checkButton:hover {
            background-color: #45a049;
        }
        #stopButton {
            background-color: #f44336;
            display: none;
        }
        #stopButton:hover {
            background-color: #d32f2f;
        }
        #clearDomains {
            background-color: #2196F3;
        }
        #clearDomains:hover {
            background-color: #0b7dda;
        }
        #showResults {
            background-color: #673AB7;
        }
        #showResults:hover {
            background-color: #5E35B1;
        }
        .results-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            z-index: 1000;
            overflow: auto;
        }
        .results-content {
            background-color: white;
            margin: 50px auto;
            padding: 20px;
            width: 80%;
            max-width: 800px;
            border-radius: 5px;
            max-height: 80vh;
            overflow-y: auto;
        }
        .close-results {
            float: right;
            font-size: 24px;
            cursor: pointer;
        }
        .result-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        .result-domain {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .result-status {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        .online {
            background-color: #4CAF50;
        }
        .offline {
            background-color: #f44336;
        }
        .error {
            background-color: #ff9800;
        }
        .result-time {
            color: #666;
            font-size: 12px;
        }
        textarea {
            width: 100%;
            height: 100px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            resize: vertical;
        }
        .timer {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: rgba(0,0,0,0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 14px;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>多域名页面检测工具</h1>
    </div>
    
    <div class="input-area">
        <p>请输入要检测的域名列表（每行一个域名，支持http/https开头或直接输入域名）：</p>
        <textarea id="domainList" placeholder="例如：
https://example.com
google.com
http://github.com"></textarea>
    </div>
    
    <div class="button-area">
        <button id="checkButton">开始检测</button>
        <button id="stopButton">停止检测</button>
        <button id="clearDomains">清理域名</button>
        <button id="showResults">检测结果</button>
        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress" id="progressBar"></div>
                <div class="progress-text" id="progressText">0/0</div>
            </div>
        </div>
    </div>
    
    <div class="viewer-area">
        <div class="status-bar" id="statusBar">
            <span id="currentDomain">准备就绪</span>
            <span id="statusText">等待开始检测</span>
        </div>
        <iframe class="browser-view" id="browserView" sandbox="allow-same-origin allow-scripts allow-popups allow-forms"></iframe>
    </div>
    
    <div class="results-modal" id="resultsModal">
        <div class="results-content">
            <span class="close-results" id="closeResults">&times;</span>
            <h2>检测结果</h2>
            <div id="resultsContainer"></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const domainListTextarea = document.getElementById('domainList');
            const checkButton = document.getElementById('checkButton');
            const stopButton = document.getElementById('stopButton');
            const clearDomainsButton = document.getElementById('clearDomains');
            const showResultsButton = document.getElementById('showResults');
            const closeResultsButton = document.getElementById('closeResults');
            const browserView = document.getElementById('browserView');
            const resultsModal = document.getElementById('resultsModal');
            const resultsContainer = document.getElementById('resultsContainer');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            const statusBar = document.getElementById('statusBar');
            const currentDomainSpan = document.getElementById('currentDomain');
            const statusTextSpan = document.getElementById('statusText');
            
            let isChecking = false;
            let currentCheckIndex = 0;
            let checkTimeout = null;
            let timerInterval = null;
            let currentTimer = 5;
            let domains = [];
            let results = [];
            
            // 检测按钮点击事件
            checkButton.addEventListener('click', function() {
                const domainsText = domainListTextarea.value.trim();
                if (!domainsText) {
                    alert('请输入至少一个域名');
                    return;
                }
                
                domains = domainsText.split('\n')
                    .map(domain => domain.trim())
                    .filter(domain => domain.length > 0)
                    .map(domain => {
                        // 自动添加http://前缀（如果没有指定协议）
                        if (!domain.startsWith('http://') && !domain.startsWith('https://')) {
                            return 'http://' + domain;
                        }
                        return domain;
                    });
                
                startChecking();
            });
            
            // 停止检测按钮
            stopButton.addEventListener('click', function() {
                stopChecking();
                statusTextSpan.textContent = '检测已停止';
                currentDomainSpan.textContent = '准备就绪';
                browserView.src = 'about:blank';
            });
            
            // 清理域名按钮
            clearDomainsButton.addEventListener('click', function() {
                domainListTextarea.value = '';
            });
            
            // 显示结果按钮
            showResultsButton.addEventListener('click', function() {
                showResults();
            });
            
            // 关闭结果窗口
            closeResultsButton.addEventListener('click', function() {
                resultsModal.style.display = 'none';
            });
            
            // 点击模态框外部关闭
            resultsModal.addEventListener('click', function(e) {
                if (e.target === resultsModal) {
                    resultsModal.style.display = 'none';
                }
            });
            
            // 开始检测
            function startChecking() {
                isChecking = true;
                checkButton.disabled = true;
                stopButton.style.display = 'inline-block';
                showResultsButton.disabled = true;
                results = [];
                currentCheckIndex = 0;
                
                // 重置进度条
                progressBar.style.width = '0%';
                progressText.textContent = `0/${domains.length}`;
                statusTextSpan.textContent = '检测中...';
                
                // 清空结果容器
                resultsContainer.innerHTML = '';
                
                // 开始检测第一个域名
                checkNextDomain();
            }
            
            // 停止检测
            function stopChecking() {
                isChecking = false;
                checkButton.disabled = false;
                stopButton.style.display = 'none';
                showResultsButton.disabled = false;
                
                // 清除定时器
                if (checkTimeout) {
                    clearTimeout(checkTimeout);
                    checkTimeout = null;
                }
                
                // 清除计时器
                if (timerInterval) {
                    clearInterval(timerInterval);
                    timerInterval = null;
                }
                
                // 移除计时显示
                const existingTimer = document.querySelector('.timer');
                if (existingTimer) {
                    existingTimer.remove();
                }
            }
            
            // 检测下一个域名
            function checkNextDomain() {
                if (!isChecking || currentCheckIndex >= domains.length) {
                    // 检测完成或已停止
                    stopChecking();
                    statusTextSpan.textContent = `检测完成，共检测 ${results.length} 个域名`;
                    
                    // 保存结果到本地存储
                    saveToHistory();
                    
                    // 启用结果按钮
                    showResultsButton.disabled = false;
                    return;
                }
                
                const domain = domains[currentCheckIndex];
                currentDomainSpan.textContent = `正在检测: ${domain}`;
                
                // 更新状态
                const progress = Math.round((currentCheckIndex / domains.length) * 100);
                progressBar.style.width = `${progress}%`;
                progressText.textContent = `${currentCheckIndex}/${domains.length}`;
                
                // 在iframe中打开页面
                browserView.src = domain;
                
                // 创建计时器显示
                const existingTimer = document.querySelector('.timer');
                if (existingTimer) {
                    existingTimer.remove();
                }
                
                const timerElement = document.createElement('div');
                timerElement.className = 'timer';
                timerElement.textContent = '5';
                document.querySelector('.viewer-area').appendChild(timerElement);
                
                currentTimer = 5;
                timerInterval = setInterval(() => {
                    currentTimer--;
                    timerElement.textContent = currentTimer;
                    
                    if (currentTimer <= 0) {
                        clearInterval(timerInterval);
                        timerInterval = null;
                        timerElement.remove();
                    }
                }, 1000);
                
                // 记录开始时间
                const startTime = Date.now();
                
                // 5秒后检测下一个域名
                checkTimeout = setTimeout(() => {
                    // 计算响应时间
                    const responseTime = Date.now() - startTime;
                    
                    // 记录结果
                    const result = {
                        domain,
                        status: 'online', // 假设能加载就是online
                        responseTime,
                        timestamp: new Date().toLocaleString(),
                        url: domain
                    };
                    
                    results.push(result);
                    currentCheckIndex++;
                    
                    // 检测下一个域名
                    checkNextDomain();
                }, 5000);
            }
            
            // 显示结果
            function showResults() {
                resultsContainer.innerHTML = '';
                
                if (results.length === 0) {
                    resultsContainer.innerHTML = '<p>没有检测结果</p>';
                } else {
                    results.forEach(result => {
                        const item = document.createElement('div');
                        item.className = 'result-item';
                        
                        const domain = document.createElement('div');
                        domain.className = 'result-domain';
                        domain.textContent = result.domain;
                        
                        const status = document.createElement('div');
                        status.className = 'result-status';
                        
                        const indicator = document.createElement('div');
                        indicator.className = `status-indicator ${result.status}`;
                        
                        const statusText = document.createElement('span');
                        if (result.status === 'online') {
                            statusText.textContent = `在线 (${result.responseTime}ms) - 页面: 已检测`;
                        } else {
                            statusText.textContent = '离线 - 无法连接';
                        }
                        
                        const time = document.createElement('div');
                        time.className = 'result-time';
                        time.textContent = result.timestamp;
                        
                        status.appendChild(indicator);
                        status.appendChild(statusText);
                        
                        item.appendChild(domain);
                        item.appendChild(status);
                        item.appendChild(time);
                        
                        resultsContainer.appendChild(item);
                    });
                }
                
                resultsModal.style.display = 'block';
            }
            
            // 保存到历史记录
            function saveToHistory() {
                let history = JSON.parse(localStorage.getItem('domainCheckHistory')) || [];
                const timestamp = new Date().toISOString();
                
                const historyEntry = {
                    timestamp,
                    domains: domains,
                    results: results
                };
                
                history.unshift(historyEntry);
                localStorage.setItem('domainCheckHistory', JSON.stringify(history));
            }
        });
    </script>
</body>
</html>
