<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>多域名页面检测工具</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }
        .header {
            background-color: #f5f5f5;
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }
        .input-area {
            padding: 15px;
            background-color: #f9f9f9;
            border-bottom: 1px solid #ddd;
        }
        .button-area {
            padding: 10px;
            background-color: #f5f5f5;
            display: flex;
            gap: 10px;
            border-bottom: 1px solid #ddd;
        }
        .viewer-area {
            flex: 1;
            display: flex;
            position: relative;
        }
        .browser-view {
            flex: 1;
            border: none;
        }
        .results-view {
            width: 300px;
            background-color: white;
            border-left: 1px solid #ddd;
            overflow-y: auto;
            display: none;
        }
        textarea {
            width: 100%;
            height: 100px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            resize: vertical;
        }
        button {
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        #checkButton {
            background-color: #4CAF50;
        }
        #checkButton:hover {
            background-color: #45a049;
        }
        #stopButton {
            background-color: #f44336;
            display: none;
        }
        #stopButton:hover {
            background-color: #d32f2f;
        }
        #clearDomains {
            background-color: #2196F3;
        }
        #clearDomains:hover {
            background-color: #0b7dda;
        }
        #showHistory {
            background-color: #673AB7;
        }
        #showHistory:hover {
            background-color: #5E35B1;
        }
        .status-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
        }
        .status-item:hover {
            background-color: #f5f5f5;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .online {
            background-color: #4CAF50;
        }
        .offline {
            background-color: #f44336;
        }
        .error {
            background-color: #ff9800;
        }
        .checking {
            background-color: #2196F3;
        }
        .current {
            background-color: #e3f2fd;
        }
        .progress-container {
            margin-top: 10px;
        }
        .progress-bar {
            height: 5px;
            background-color: #e0e0e0;
            border-radius: 2px;
            overflow: hidden;
        }
        .progress {
            height: 100%;
            background-color: #4CAF50;
            width: 0%;
            transition: width 0.3s;
        }
        .status-text {
            margin-top: 5px;
            font-size: 12px;
            color: #666;
        }
        .timer {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: rgba(0,0,0,0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 14px;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>多域名页面检测工具</h1>
    </div>
    
    <div class="input-area">
        <p>请输入要检测的域名列表（每行一个域名，支持http/https开头或直接输入域名）：</p>
        <textarea id="domainList" placeholder="例如：
https://example.com
google.com
http://github.com"></textarea>
    </div>
    
    <div class="button-area">
        <button id="checkButton">开始检测</button>
        <button id="stopButton">停止检测</button>
        <button id="clearDomains">清理域名</button>
        <button id="showHistory">检测历史</button>
        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress" id="progressBar"></div>
            </div>
            <div class="status-text" id="statusText">准备就绪</div>
        </div>
    </div>
    
    <div class="viewer-area">
        <iframe class="browser-view" id="browserView" sandbox="allow-same-origin allow-scripts allow-popups allow-forms"></iframe>
        <div class="results-view" id="resultsView">
            <h3>检测结果</h3>
            <div id="resultsContainer"></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const domainListTextarea = document.getElementById('domainList');
            const checkButton = document.getElementById('checkButton');
            const stopButton = document.getElementById('stopButton');
            const clearDomainsButton = document.getElementById('clearDomains');
            const showHistoryButton = document.getElementById('showHistory');
            const browserView = document.getElementById('browserView');
            const resultsView = document.getElementById('resultsView');
            const resultsContainer = document.getElementById('resultsContainer');
            const progressBar = document.getElementById('progressBar');
            const statusText = document.getElementById('statusText');
            
            let isChecking = false;
            let currentCheckIndex = 0;
            let checkTimeout = null;
            let timerInterval = null;
            let currentTimer = 0;
            let domains = [];
            let results = [];
            
            // 检测按钮点击事件
            checkButton.addEventListener('click', function() {
                const domainsText = domainListTextarea.value.trim();
                if (!domainsText) {
                    alert('请输入至少一个域名');
                    return;
                }
                
                domains = domainsText.split('\n')
                    .map(domain => domain.trim())
                    .filter(domain => domain.length > 0)
                    .map(domain => {
                        // 自动添加http://前缀（如果没有指定协议）
                        if (!domain.startsWith('http://') && !domain.startsWith('https://')) {
                            return 'http://' + domain;
                        }
                        return domain;
                    });
                
                startChecking();
            });
            
            // 停止检测按钮
            stopButton.addEventListener('click', function() {
                stopChecking();
                statusText.textContent = '检测已停止';
            });
            
            // 清理域名按钮
            clearDomainsButton.addEventListener('click', function() {
                domainListTextarea.value = '';
            });
            
            // 显示历史记录
            showHistoryButton.addEventListener('click', function() {
                resultsView.style.display = 'block';
                loadHistory();
            });
            
            // 开始检测
            function startChecking() {
                isChecking = true;
                checkButton.disabled = true;
                stopButton.style.display = 'inline-block';
                results = [];
                currentCheckIndex = 0;
                
                // 重置进度条
                progressBar.style.width = '0%';
                statusText.textContent = '准备开始检测...';
                
                // 清空结果容器
                resultsContainer.innerHTML = '';
                
                // 隐藏结果视图（如果显示）
                resultsView.style.display = 'none';
                
                // 开始检测第一个域名
                checkNextDomain();
            }
            
            // 停止检测
            function stopChecking() {
                isChecking = false;
                checkButton.disabled = false;
                stopButton.style.display = 'none';
                
                // 清除定时器
                if (checkTimeout) {
                    clearTimeout(checkTimeout);
                    checkTimeout = null;
                }
                
                // 清除计时器
                if (timerInterval) {
                    clearInterval(timerInterval);
                    timerInterval = null;
                }
                
                // 移除计时显示
                const existingTimer = document.querySelector('.timer');
                if (existingTimer) {
                    existingTimer.remove();
                }
            }
            
            // 检测下一个域名
            function checkNextDomain() {
                if (!isChecking || currentCheckIndex >= domains.length) {
                    // 检测完成或已停止
                    stopChecking();
                    statusText.textContent = `检测完成，共检测 ${results.length} 个域名`;
                    
                    // 保存结果到历史记录
                    saveToHistory();
                    
                    // 显示结果视图
                    resultsView.style.display = 'block';
                    return;
                }
                
                const domain = domains[currentCheckIndex];
                currentCheckIndex++;
                
                // 更新状态
                const progress = Math.round((currentCheckIndex / domains.length) * 100);
                progressBar.style.width = `${progress}%`;
                statusText.textContent = `正在检测: ${domain} (${currentCheckIndex}/${domains.length})`;
                
                // 在iframe中打开页面
                browserView.src = domain;
                
                // 创建计时器显示
                const existingTimer = document.querySelector('.timer');
                if (existingTimer) {
                    existingTimer.remove();
                }
                
                const timerElement = document.createElement('div');
                timerElement.className = 'timer';
                timerElement.textContent = '5';
                document.querySelector('.viewer-area').appendChild(timerElement);
                
                currentTimer = 5;
                timerInterval = setInterval(() => {
                    currentTimer--;
                    timerElement.textContent = currentTimer;
                    
                    if (currentTimer <= 0) {
                        clearInterval(timerInterval);
                        timerInterval = null;
                        timerElement.remove();
                    }
                }, 1000);
                
                // 5秒后检测下一个域名
                checkTimeout = setTimeout(() => {
                    // 记录结果（由于同源策略限制，我们无法准确获取页面状态）
                    const result = {
                        domain,
                        status: 'online', // 假设能加载就是online
                        timestamp: new Date().toISOString(),
                        url: domain
                    };
                    
                    results.push(result);
                    addResultItem(result, results.length - 1);
                    
                    // 检测下一个域名
                    checkNextDomain();
                }, 5000);
            }
            
            // 添加结果项
            function addResultItem(result, index) {
                const item = document.createElement('div');
                item.className = 'status-item';
                item.dataset.index = index;
                
                const indicator = document.createElement('span');
                indicator.className = `status-indicator ${result.status}`;
                
                const domainText = document.createElement('span');
                domainText.textContent = result.domain;
                
                item.appendChild(indicator);
                item.appendChild(domainText);
                
                // 点击结果项可以在浏览器视图中打开
                item.addEventListener('click', function() {
                    browserView.src = result.url;
                    
                    // 高亮当前选中的项
                    document.querySelectorAll('.status-item').forEach(el => {
                        el.classList.remove('current');
                    });
                    item.classList.add('current');
                });
                
                resultsContainer.appendChild(item);
            }
            
            // 保存到历史记录
            function saveToHistory() {
                let history = JSON.parse(localStorage.getItem('domainCheckHistory')) || [];
                const timestamp = new Date().toISOString();
                
                const historyEntry = {
                    timestamp,
                    domains: domains,
                    results: results
                };
                
                history.unshift(historyEntry);
                localStorage.setItem('domainCheckHistory', JSON.stringify(history));
            }
            
            // 加载历史记录
            function loadHistory() {
                const history = JSON.parse(localStorage.getItem('domainCheckHistory')) || [];
                resultsContainer.innerHTML = '';
                
                if (history.length === 0) {
                    resultsContainer.innerHTML = '<p>没有历史记录</p>';
                    return;
                }
                
                // 显示所有历史记录组
                history.forEach((entry, groupIndex) => {
                    const groupHeader = document.createElement('div');
                    groupHeader.style.padding = '10px';
                    groupHeader.style.backgroundColor = '#f0f0f0';
                    groupHeader.style.marginTop = groupIndex > 0 ? '15px' : '0';
                    groupHeader.textContent = new Date(entry.timestamp).toLocaleString() + 
                                             ` (${entry.results.length}个域名)`;
                    resultsContainer.appendChild(groupHeader);
                    
                    // 显示该组的所有结果
                    entry.results.forEach((result, index) => {
                        const item = document.createElement('div');
                        item.className = 'status-item';
                        
                        const indicator = document.createElement('span');
                        indicator.className = `status-indicator ${result.status}`;
                        
                        const domainText = document.createElement('span');
                        domainText.textContent = result.domain;
                        
                        item.appendChild(indicator);
                        item.appendChild(domainText);
                        
                        // 点击历史项可以查看
                        item.addEventListener('click', function() {
                            browserView.src = result.url;
                            domainListTextarea.value = entry.domains.join('\n');
                            
                            // 高亮当前选中的项
                            document.querySelectorAll('.status-item').forEach(el => {
                                el.classList.remove('current');
                            });
                            item.classList.add('current');
                        });
                        
                        resultsContainer.appendChild(item);
                    });
                });
            }
        });
    </script>
</body>
</html>